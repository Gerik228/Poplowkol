

```sql
-- –£–¥–∞–ª–µ–Ω–∏–µ –≤—Å–µ—Ö –ø—Ä–æ—Ü–µ–¥—É—Ä —Å–≤—è–∑–∞–Ω–Ω—ã—Ö —Å —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–µ–π
BEGIN
    FOR proc IN (
        SELECT object_name 
        FROM user_objects 
        WHERE object_type = 'PROCEDURE' 
        AND (
            object_name LIKE 'SYNC_%' OR
            object_name LIKE '%SYNC%' OR
            object_name LIKE 'CREATE_SMART%' OR
            object_name LIKE 'VALIDATE_%' OR
            object_name LIKE 'MANAGE_%'
        )
    ) LOOP
        BEGIN
            EXECUTE IMMEDIATE 'DROP PROCEDURE ' || proc.object_name;
            DBMS_OUTPUT.PUT_LINE('–£–¥–∞–ª–µ–Ω–∞ –ø—Ä–æ—Ü–µ–¥—É—Ä–∞: ' || proc.object_name);
        EXCEPTION
            WHEN OTHERS THEN
                DBMS_OUTPUT.PUT_LINE('–û—à–∏–±–∫–∞ –ø—Ä–∏ —É–¥–∞–ª–µ–Ω–∏–∏ –ø—Ä–æ—Ü–µ–¥—É—Ä—ã ' || proc.object_name || ': ' || SQLERRM);
        END;
    
/
```

### 1.2 –£–¥–∞–ª–µ–Ω–∏–µ –≤—Å–µ—Ö –∑–∞–¥–∞–Ω–∏–π –ø–ª–∞–Ω–∏—Ä–æ–≤—â–∏–∫–∞

```sql
-- –£–¥–∞–ª–µ–Ω–∏–µ –≤—Å–µ—Ö –∑–∞–¥–∞–Ω–∏–π —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏
BEGIN
    FOR job IN (
        SELECT job_name 
        FROM user_scheduler_jobs 
        WHERE job_name LIKE 'SYNC_%'
    ) LOOP
        BEGIN
            DBMS_SCHEDULER.DROP_JOB(job_name => job.job_name, force => TRUE);
            DBMS_OUTPUT.PUT_LINE('–£–¥–∞–ª–µ–Ω–æ –∑–∞–¥–∞–Ω–∏–µ: ' || job.job_name);
        EXCEPTION
            WHEN OTHERS THEN
                DBMS_OUTPUT.PUT_LINE('–û—à–∏–±–∫–∞ –ø—Ä–∏ —É–¥–∞–ª–µ–Ω–∏–∏ –∑–∞–¥–∞–Ω–∏—è ' || job.job_name || ': ' || SQLERRM);
        END;
    END LOOP;
END;
/
```

### 1.3 –£–¥–∞–ª–µ–Ω–∏–µ —Å—Ç–∞—Ä—ã—Ö —Ç–∞–±–ª–∏—Ü —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏ –∏ –ª–æ–≥–æ–≤

```sql
-- –£–¥–∞–ª–µ–Ω–∏–µ –≤—Å–µ—Ö –ª–æ–∫–∞–ª—å–Ω—ã—Ö backup —Ç–∞–±–ª–∏—Ü
BEGIN
    FOR tab IN (
        SELECT table_name 
        FROM user_tables 
        WHERE table_name LIKE 'LOCAL_%BACKUP' OR 
              table_name LIKE 'LOCAL_%OLD' OR
              table_name = 'SYNC_LOG'
    ) LOOP
        BEGIN
            EXECUTE IMMEDIATE 'DROP TABLE ' || tab.table_name || ' CASCADE CONSTRAINTS';
            DBMS_OUTPUT.PUT_LINE('–£–¥–∞–ª–µ–Ω–∞ —Ç–∞–±–ª–∏—Ü–∞: ' || tab.table_name);
        EXCEPTION
            WHEN OTHERS THEN
                DBMS_OUTPUT.PUT_LINE('–û—à–∏–±–∫–∞ –ø—Ä–∏ —É–¥–∞–ª–µ–Ω–∏–∏ —Ç–∞–±–ª–∏—Ü—ã ' || tab.table_name || ': ' || SQLERRM);
        END;
    END LOOP;
END;
/
```

## –®–∞–≥ 2: –°–æ–∑–¥–∞–Ω–∏–µ –Ω–æ–≤—ã—Ö –æ–±—ä–µ–∫—Ç–æ–≤ —Å–∏—Å—Ç–µ–º—ã —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏

### 2.1 –°–æ–∑–¥–∞–Ω–∏–µ —Ç–∞–±–ª–∏—Ü—ã –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞

```sql
-- –°–æ–∑–¥–∞–Ω–∏–µ —Ä–∞—Å—à–∏—Ä–µ–Ω–Ω–æ–π —Ç–∞–±–ª–∏—Ü—ã –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞
CREATE TABLE sync_log (
    id NUMBER GENERATED ALWAYS AS IDENTITY,
    table_name VARCHAR2(128) NOT NULL,
    sync_date DATE NOT NULL,
    sync_type VARCHAR2(20) NOT NULL DEFAULT 'FULL',
    status VARCHAR2(15) NOT NULL,
    source_row_count NUMBER DEFAULT 0,
    target_row_count NUMBER DEFAULT 0,
    duration_seconds NUMBER,
    validation_result VARCHAR2(4000),
    error_msg VARCHAR2(4000),
    created_at TIMESTAMP DEFAULT SYSTIMESTAMP,
    CONSTRAINT pk_sync_log PRIMARY KEY (id),
    CONSTRAINT chk_sync_status CHECK (status IN ('SUCCESS', 'ERROR', 'WARNING', 'EMPTY_SOURCE')),
    CONSTRAINT chk_sync_type CHECK (sync_type IN ('FULL', 'INCREMENTAL'))
);

-- –°–æ–∑–¥–∞–Ω–∏–µ –∏–Ω–¥–µ–∫—Å–æ–≤ –¥–ª—è –±—ã—Å—Ç—Ä–æ–≥–æ –ø–æ–∏—Å–∫–∞
CREATE INDEX idx_sync_log_table_date ON sync_log(table_name, sync_date);
CREATE INDEX idx_sync_log_status ON sync_log(status);
CREATE INDEX idx_sync_log_created ON sync_log(created_at);

COMMENT ON TABLE sync_log IS '–ñ—É—Ä–Ω–∞–ª —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏ —Ç–∞–±–ª–∏—Ü —á–µ—Ä–µ–∑ dblink';
```

### 2.2 –ü—Ä–æ—Ü–µ–¥—É—Ä–∞ –∫–æ–º–ø–ª–µ–∫—Å–Ω–æ–π –ø—Ä–æ–≤–µ—Ä–∫–∏ –æ–∫—Ä—É–∂–µ–Ω–∏—è

```sql
CREATE OR REPLACE PROCEDURE validate_sync_environment(
    p_table_name VARCHAR2,
    p_dblink_name VARCHAR2,
    p_validation_result OUT VARCHAR2,
    p_source_count OUT NUMBER,
    p_is_valid OUT BOOLEAN
) IS
    v_count NUMBER;
    v_dblink_valid BOOLEAN := FALSE;
    v_table_exists NUMBER := 0;
    v_structure_check VARCHAR2(4000);
    v_full_table_name VARCHAR2(256);
    v_source_schema VARCHAR2(128);
    v_base_table_name VARCHAR2(128);
BEGIN
    p_is_valid := FALSE;
    p_validation_result := '';
    p_source_count := 0;
    
    -- –ü–∞—Ä—Å–∏–Ω–≥ –∏–º–µ–Ω–∏ —Ç–∞–±–ª–∏—Ü—ã
    v_full_table_name := UPPER(TRIM(p_table_name));
    IF INSTR(v_full_table_name, '.') > 0 THEN
        v_source_schema := REGEXP_SUBSTR(v_full_table_name, '^[^.]+');
        v_base_table_name := REGEXP_SUBSTR(v_full_table_name, '[^.]+$');
    ELSE
        v_source_schema := NULL;
        v_base_table_name := v_full_table_name;
    END IF;
    
    -- –§–æ—Ä–º–∏—Ä—É–µ–º –ø–æ–ª–Ω–æ–µ –∏–º—è –¥–ª—è –∑–∞–ø—Ä–æ—Å–∞
    IF v_source_schema IS NOT NULL THEN
        v_full_table_name := v_source_schema || '.' || v_base_table_name;
    ELSE
        v_full_table_name := v_base_table_name;
    END IF;
    
    -- 1. –ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏ dblink
    BEGIN
        EXECUTE IMMEDIATE 'SELECT COUNT(*) FROM dual@' || p_dblink_name INTO v_count;
        v_dblink_valid := TRUE;
        p_validation_result := p_validation_result || 'DBLINK_OK; ';
    EXCEPTION
        WHEN OTHERS THEN
            p_validation_result := p_validation_result || 'DBLINK_ERROR: ' || SQLERRM || '; ';
            RETURN;
    END;
    
    -- 2. –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—É—â–µ—Å—Ç–≤–æ–≤–∞–Ω–∏—è —É–¥–∞–ª–µ–Ω–Ω–æ–π —Ç–∞–±–ª–∏—Ü—ã
    BEGIN
        EXECUTE IMMEDIATE 'SELECT COUNT(*) FROM ' || v_full_table_name || '@' || p_dblink_name || ' WHERE ROWNUM = 1' INTO v_table_exists;
        p_validation_result := p_validation_result || 'TABLE_EXISTS; ';
    EXCEPTION
        WHEN OTHERS THEN
            IF SQLCODE = -942 THEN
                p_validation_result := p_validation_result || 'TABLE_NOT_EXISTS; ';
            ELSE
                p_validation_result := p_validation_result || 'TABLE_ACCESS_ERROR: ' || SQLERRM || '; ';
            END IF;
            RETURN;
    END;
    
    -- 3. –ü–æ–¥—Å—á–µ—Ç –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ –∑–∞–ø–∏—Å–µ–π –≤ –∏—Å—Ç–æ—á–Ω–∏–∫–µ
    BEGIN
        EXECUTE IMMEDIATE 'SELECT COUNT(*) FROM ' || v_full_table_name || '@' || p_dblink_name INTO p_source_count;
        p_validation_result := p_validation_result || 'SOURCE_COUNT: ' || p_source_count || '; ';
    EXCEPTION
        WHEN OTHERS THEN
            p_validation_result := p_validation_result || 'COUNT_ERROR: ' || SQLERRM || '; ';
            RETURN;
    END;
    
    -- 4. –ë–∞–∑–æ–≤–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
    BEGIN
        EXECUTE IMMEDIATE 'SELECT column_name FROM user_tab_columns@' || p_dblink_name || 
                         ' WHERE table_name = ''' || UPPER(v_base_table_name) || ''' AND ROWNUM = 1' INTO v_structure_check;
        p_validation_result := p_validation_result || 'STRUCTURE_OK; ';
    EXCEPTION
        WHEN NO_DATA_FOUND THEN
            p_validation_result := p_validation_result || 'NO_COLUMNS_INFO; ';
        WHEN OTHERS THEN
            p_validation_result := p_validation_result || 'STRUCTURE_CHECK_SKIP; ';
    END;
    
    -- –§–∏–Ω–∞–ª—å–Ω–∞—è –æ—Ü–µ–Ω–∫–∞
    IF v_dblink_valid AND v_table_exists >= 0 THEN
        p_is_valid := TRUE;
        p_validation_result := p_validation_result || 'VALIDATION_PASSED';
    END IF;
    
EXCEPTION
    WHEN OTHERS THEN
        p_validation_result := 'VALIDATION_FATAL_ERROR: ' || SQLERRM;
        p_is_valid := FALSE;
END validate_sync_environment;
/
```

### 2.3 –û—Å–Ω–æ–≤–Ω–∞—è –ø—Ä–æ—Ü–µ–¥—É—Ä–∞ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏

```sql
CREATE OR REPLACE PROCEDURE sync_single_table_advanced(
    p_table_name VARCHAR2,
    p_dblink_name VARCHAR2,
    p_sync_type VARCHAR2 DEFAULT 'FULL',
    p_min_row_threshold NUMBER DEFAULT 0
) IS
    -- –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –¥–ª—è –ø–∞—Ä—Å–∏–Ω–≥–∞ –∏–º–µ–Ω–∏ —Ç–∞–±–ª–∏—Ü—ã
    v_full_table_name VARCHAR2(256);
    v_source_schema VARCHAR2(128);
    v_base_table_name VARCHAR2(128);
    v_select_from VARCHAR2(512);
    
    -- –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –¥–ª—è –ª–æ–∫–∞–ª—å–Ω—ã—Ö –∏–º–µ–Ω
    v_local_table_name VARCHAR2(128);
    v_backup_table_name VARCHAR2(128);
    
    -- –°–ª—É–∂–µ–±–Ω—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ
    v_ddl_statement VARCHAR2(4000);
    v_error_msg VARCHAR2(4000);
    v_start_time TIMESTAMP;
    v_end_time TIMESTAMP;
    v_source_count NUMBER := 0;
    v_target_count NUMBER := 0;
    v_validation_result VARCHAR2(4000);
    v_is_environment_valid BOOLEAN;
    v_sync_status VARCHAR2(15) := 'ERROR';
    v_should_proceed BOOLEAN := FALSE;
BEGIN
    v_start_time := SYSTIMESTAMP;
    
    -- –ü–∞—Ä—Å–∏–Ω–≥ –≤—Ö–æ–¥–Ω–æ–≥–æ –ø–∞—Ä–∞–º–µ—Ç—Ä–∞
    v_full_table_name := UPPER(TRIM(p_table_name));
    IF INSTR(v_full_table_name, '.') > 0 THEN
        v_source_schema := REGEXP_SUBSTR(v_full_table_name, '^[^.]+');
        v_base_table_name := REGEXP_SUBSTR(v_full_table_name, '[^.]+$');
    ELSE
        v_source_schema := NULL;
        v_base_table_name := v_full_table_name;
    END IF;
    
    -- –§–æ—Ä–º–∏—Ä—É–µ–º –∏–º–µ–Ω–∞ –ª–æ–∫–∞–ª—å–Ω—ã—Ö —Ç–∞–±–ª–∏—Ü (–≤—Å–µ–≥–¥–∞ –±–µ–∑ —Å—Ö–µ–º—ã)
    v_local_table_name := 'LOCAL_' || v_base_table_name || '_BACKUP';
    v_backup_table_name := 'LOCAL_' || v_base_table_name || '_OLD';
    
    -- –§–æ—Ä–º–∏—Ä—É–µ–º FROM-—á–∞—Å—Ç—å –¥–ª—è –∑–∞–ø—Ä–æ—Å–æ–≤ —á–µ—Ä–µ–∑ dblink
    IF v_source_schema IS NOT NULL THEN
        v_select_from := v_source_schema || '.' || v_base_table_name || '@' || p_dblink_name;
    ELSE
        v_select_from := v_base_table_name || '@' || p_dblink_name;
    END IF;
    
    -- –í—Å–µ—Å—Ç–æ—Ä–æ–Ω–Ω—è—è –ø—Ä–æ–≤–µ—Ä–∫–∞ –æ–∫—Ä—É–∂–µ–Ω–∏—è
    validate_sync_environment(
        p_table_name => p_table_name,
        p_dblink_name => p_dblink_name,
        p_validation_result => v_validation_result,
        p_source_count => v_source_count,
        p_is_valid => v_is_environment_valid
    );
    
    -- –ü—Ä–∏–Ω—è—Ç–∏–µ —Ä–µ—à–µ–Ω–∏—è –æ –ø—Ä–æ–¥–æ–ª–∂–µ–Ω–∏–∏ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏
    IF NOT v_is_environment_valid THEN
        v_sync_status := 'ERROR';
        v_error_msg := 'Environment validation failed: ' || v_validation_result;
    ELSIF v_source_count < p_min_row_threshold THEN
        v_sync_status := 'EMPTY_SOURCE';
        v_error_msg := 'Source table has insufficient data (' || v_source_count || ' rows, threshold: ' || p_min_row_threshold || ')';
    ELSE
        v_should_proceed := TRUE;
    END IF;
    
    -- –í—ã–ø–æ–ª–Ω–µ–Ω–∏–µ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏ –ø—Ä–∏ –ø—Ä–æ—Ö–æ–∂–¥–µ–Ω–∏–∏ –≤—Å–µ—Ö –ø—Ä–æ–≤–µ—Ä–æ–∫
    IF v_should_proceed THEN
        BEGIN
            -- –°–æ–∑–¥–∞–Ω–∏–µ —Ä–µ–∑–µ—Ä–≤–Ω–æ–π –∫–æ–ø–∏–∏ —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–π —Ç–∞–±–ª–∏—Ü—ã
            BEGIN
                EXECUTE IMMEDIATE 'ALTER TABLE ' || v_local_table_name || 
                                 ' RENAME TO ' || v_backup_table_name;
            EXCEPTION
                WHEN OTHERS THEN 
                    DBMS_OUTPUT.PUT_LINE('–ü—Ä–µ–¥—ã–¥—É—â–∞—è –≤–µ—Ä—Å–∏—è —Ç–∞–±–ª–∏—Ü—ã –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç - —Å–æ–∑–¥–∞–µ–º –Ω–æ–≤—É—é');
            END;
            
            -- –°–æ–∑–¥–∞–Ω–∏–µ –Ω–æ–≤–æ–π —Ç–∞–±–ª–∏—Ü—ã
            v_ddl_statement := 'CREATE TABLE ' || v_local_table_name || 
                              ' AS SELECT * FROM ' || v_select_from;
            
            EXECUTE IMMEDIATE v_ddl_statement;
            
            -- –ü–æ–¥—Å—á–µ—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞
            EXECUTE IMMEDIATE 'SELECT COUNT(*) FROM ' || v_local_table_name INTO v_target_count;
            
            -- –í–∞–ª–∏–¥–∞—Ü–∏—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞
            IF v_target_count = v_source_count THEN
                v_sync_status := 'SUCCESS';
                
                -- –£–¥–∞–ª–µ–Ω–∏–µ —Å—Ç–∞—Ä–æ–π —Ä–µ–∑–µ—Ä–≤–Ω–æ–π –∫–æ–ø–∏–∏
                BEGIN
                    EXECUTE IMMEDIATE 'DROP TABLE ' || v_backup_table_name;
                EXCEPTION
                    WHEN OTHERS THEN NULL;
                END;
                
                -- –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏
                BEGIN
                    DBMS_STATS.GATHER_TABLE_STATS(USER, v_local_table_name);
                EXCEPTION
                    WHEN OTHERS THEN NULL;
                END;
                
            ELSE
                v_sync_status := 'WARNING';
                v_error_msg := 'Row count mismatch: source=' || v_source_count || ', target=' || v_target_count;
            END IF;
            
        EXCEPTION
            WHEN OTHERS THEN
                v_error_msg := SQLERRM;
                v_sync_status := 'ERROR';
                
                -- –í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ –ø—Ä–µ–¥—ã–¥—É—â–µ–π –≤–µ—Ä—Å–∏–∏ –ø—Ä–∏ –æ—à–∏–±–∫–µ
                BEGIN
                    EXECUTE IMMEDIATE 'DROP TABLE ' || v_local_table_name;
                EXCEPTION
                    WHEN OTHERS THEN NULL;
                END;
                
                BEGIN
                    EXECUTE IMMEDIATE 'ALTER TABLE ' || v_backup_table_name || 
                                     ' RENAME TO ' || v_local_table_name;
                    DBMS_OUTPUT.PUT_LINE('–í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∞ –ø—Ä–µ–¥—ã–¥—É—â–∞—è –≤–µ—Ä—Å–∏—è —Ç–∞–±–ª–∏—Ü—ã');
                EXCEPTION
                    WHEN OTHERS THEN NULL;
                END;
        END;
    END IF;
    
    -- –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞
    v_end_time := SYSTIMESTAMP;
    INSERT INTO sync_log (
        table_name, sync_date, sync_type, status, 
        source_row_count, target_row_count, duration_seconds,
        validation_result, error_msg
    ) VALUES (
        p_table_name, SYSDATE, p_sync_type, v_sync_status,
        v_source_count, v_target_count, 
        EXTRACT(SECOND FROM (v_end_time - v_start_time)),
        v_validation_result, v_error_msg
    );
    COMMIT;
    
    -- –ò–Ω—Ñ–æ—Ä–º–∞—Ç–∏–≤–Ω—ã–π –≤—ã–≤–æ–¥
    DBMS_OUTPUT.PUT_LINE('=== –û–¢–ß–ï–¢ –°–ò–ù–•–†–û–ù–ò–ó–ê–¶–ò–ò –î–õ–Ø ' || p_table_name || ' ===');
    DBMS_OUTPUT.PUT_LINE('–°—Ç–∞—Ç—É—Å: ' || v_sync_status);
    DBMS_OUTPUT.PUT_LINE('–°—Ç—Ä–æ–∫ –≤ –∏—Å—Ç–æ—á–Ω–∏–∫–µ: ' || v_source_count);
    DBMS_OUTPUT.PUT_LINE('–°—Ç—Ä–æ–∫ –≤ –ª–æ–∫–∞–ª—å–Ω–æ–π –∫–æ–ø–∏–∏: ' || v_target_count);
    DBMS_OUTPUT.PUT_LINE('–õ–æ–∫–∞–ª—å–Ω–∞—è —Ç–∞–±–ª–∏—Ü–∞: ' || v_local_table_name);
    DBMS_OUTPUT.PUT_LINE('–í–∞–ª–∏–¥–∞—Ü–∏—è: ' || v_validation_result);
    IF v_error_msg IS NOT NULL THEN
        DBMS_OUTPUT.PUT_LINE('–û—à–∏–±–∫–∞: ' || v_error_msg);
    END IF;
    
END sync_single_table_advanced;
/
```

### 2.4 –ü—Ä–æ—Ü–µ–¥—É—Ä–∞ —Å–æ–∑–¥–∞–Ω–∏—è –∑–∞–¥–∞–Ω–∏–π –ø–ª–∞–Ω–∏—Ä–æ–≤—â–∏–∫–∞

```sql
CREATE OR REPLACE PROCEDURE create_smart_sync_job(
    p_table_name VARCHAR2,
    p_schedule_interval VARCHAR2 DEFAULT 'FREQ=DAILY;BYHOUR=20',
    p_dblink_name VARCHAR2,
    p_sync_type VARCHAR2 DEFAULT 'FULL',
    p_min_row_threshold NUMBER DEFAULT 1,
    p_test_run BOOLEAN DEFAULT TRUE
) IS
    v_job_name VARCHAR2(128);
    v_test_result VARCHAR2(4000);
    v_source_count NUMBER;
    v_is_valid BOOLEAN;
    v_base_table_name VARCHAR2(128);
BEGIN
    -- –ò–∑–≤–ª–µ–∫–∞–µ–º –±–∞–∑–æ–≤–æ–µ –∏–º—è —Ç–∞–±–ª–∏—Ü—ã –¥–ª—è job_name
    IF INSTR(p_table_name, '.') > 0 THEN
        v_base_table_name := REGEXP_SUBSTR(UPPER(TRIM(p_table_name)), '[^.]+$');
    ELSE
        v_base_table_name := UPPER(TRIM(p_table_name));
    END IF;
    
    v_job_name := 'SYNC_' || v_base_table_name || '_JOB';
    
    -- –û–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–π —Ç–µ—Å—Ç–æ–≤—ã–π –∑–∞–ø—É—Å–∫
    IF p_test_run THEN
        DBMS_OUTPUT.PUT_LINE('=== –í–´–ü–û–õ–ù–ï–ù–ò–ï –¢–ï–°–¢–û–í–û–ì–û –ó–ê–ü–£–°–ö–ê ===');
        validate_sync_environment(
            p_table_name => p_table_name,
            p_dblink_name => p_dblink_name,
            p_validation_result => v_test_result,
            p_source_count => v_source_count,
            p_is_valid => v_is_valid
        );
        
        DBMS_OUTPUT.PUT_LINE('–†–µ–∑—É–ª—å—Ç–∞—Ç —Ç–µ—Å—Ç–æ–≤–æ–π –≤–∞–ª–∏–¥–∞—Ü–∏–∏: ' || v_test_result);
        
        IF NOT v_is_valid THEN
            RAISE_APPLICATION_ERROR(-20001, '–¢–µ—Å—Ç–æ–≤–∞—è –≤–∞–ª–∏–¥–∞—Ü–∏—è –Ω–µ –ø—Ä–æ–π–¥–µ–Ω–∞: ' || v_test_result);
        END IF;
        
        IF v_source_count < p_min_row_threshold THEN
            RAISE_APPLICATION_ERROR(-20002, '–í –∏—Å—Ö–æ–¥–Ω–æ–π —Ç–∞–±–ª–∏—Ü–µ –Ω–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –¥–∞–Ω–Ω—ã—Ö (' || 
                v_source_count || ' —Å—Ç—Ä–æ–∫, –º–∏–Ω–∏–º—É–º —Ç—Ä–µ–±—É–µ—Ç—Å—è: ' || p_min_row_threshold || ')');
        END IF;
        
        DBMS_OUTPUT.PUT_LINE('–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –ø—Ä–æ—à–ª–æ —É—Å–ø–µ—à–Ω–æ. –ù–∞–π–¥–µ–Ω–æ —Å—Ç—Ä–æ–∫: ' || v_source_count);
    END IF;
    
    -- –£–¥–∞–ª–µ–Ω–∏–µ —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–≥–æ –∑–∞–¥–∞–Ω–∏—è
    BEGIN
        DBMS_SCHEDULER.DROP_JOB(job_name => v_job_name, force => TRUE);
        DBMS_OUTPUT.PUT_LINE('–£–¥–∞–ª–µ–Ω–æ —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–µ –∑–∞–¥–∞–Ω–∏–µ: ' || v_job_name);
    EXCEPTION
        WHEN OTHERS THEN 
            DBMS_OUTPUT.PUT_LINE('–ü—Ä–µ–¥—ã–¥—É—â–µ–≥–æ –∑–∞–¥–∞–Ω–∏—è –Ω–µ –Ω–∞–π–¥–µ–Ω–æ');
    END;
    
    -- –°–æ–∑–¥–∞–Ω–∏–µ –Ω–æ–≤–æ–≥–æ –∑–∞–¥–∞–Ω–∏—è
    DBMS_SCHEDULER.CREATE_JOB(
        job_name        => v_job_name,
        job_type        => 'PLSQL_BLOCK',
        job_action      => 'BEGIN sync_single_table_advanced(''' || p_table_name || ''', ''' || 
                          p_dblink_name || ''', ''' || p_sync_type || ''', ' || 
                          p_min_row_threshold || '); END;',
        start_date      => SYSTIMESTAMP + INTERVAL '5' MINUTE,
        repeat_interval => p_schedule_interval,
        enabled         => TRUE,
        comments        => '–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è —Ç–∞–±–ª–∏—Ü—ã ' || p_table_name || ' (—Ç–∏–ø: ' || p_sync_type || ')'
    );
    
    DBMS_OUTPUT.PUT_LINE('=== –ó–ê–î–ê–ù–ò–ï –°–û–ó–î–ê–ù–û –£–°–ü–ï–®–ù–û ===');
    DBMS_OUTPUT.PUT_LINE('–ò–º—è –∑–∞–¥–∞–Ω–∏—è: ' || v_job_name);
    DBMS_OUTPUT.PUT_LINE('–†–∞—Å–ø–∏—Å–∞–Ω–∏–µ: ' || p_schedule_interval);
    DBMS_OUTPUT.PUT_LINE('–¢–∏–ø —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏: ' || p_sync_type);
    DBMS_OUTPUT.PUT_LINE('–ú–∏–Ω–∏–º–∞–ª—å–Ω—ã–π –ø–æ—Ä–æ–≥ —Å—Ç—Ä–æ–∫: ' || p_min_row_threshold);
    DBMS_OUTPUT.PUT_LINE('–ü–µ—Ä–≤—ã–π –∑–∞–ø—É—Å–∫: —á–µ—Ä–µ–∑ 5 –º–∏–Ω—É—Ç');
    
END create_smart_sync_job;
/
```

### 2.5 –ü—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–∏–µ –¥–ª—è –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞

```sql
CREATE OR REPLACE VIEW v_sync_dashboard AS
SELECT 
    table_name,
    sync_type,
    status,
    sync_date,
    source_row_count,
    target_row_count,
    ROUND(duration_seconds, 2) as duration_sec,
    CASE 
        WHEN status = 'SUCCESS' AND sync_date > SYSDATE - 1 THEN 'HEALTHY'
        WHEN status = 'EMPTY_SOURCE' THEN 'EMPTY_SOURCE'
        WHEN status = 'WARNING' THEN 'WARNING'
        WHEN sync_date < SYSDATE - 2 THEN 'OUTDATED'
        ELSE 'ERROR'
    END as health_status,
    SUBSTR(validation_result, 1, 100) as validation_short,
    SUBSTR(error_msg, 1, 200) as error_short,
    created_at
FROM (
    SELECT *,
           ROW_NUMBER() OVER (PARTITION BY table_name ORDER BY sync_date DESC) as rn
    FROM sync_log
) WHERE rn = 1
ORDER BY 
    CASE health_status 
        WHEN 'ERROR' THEN 1 
        WHEN 'WARNING' THEN 2 
        WHEN 'OUTDATED' THEN 3 
        WHEN 'EMPTY_SOURCE' THEN 4 
        ELSE 5 
    END,
    sync_date DESC;

COMMENT ON VIEW v_sync_dashboard IS '–ü–∞–Ω–µ–ª—å –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏ —Ç–∞–±–ª–∏—Ü';
```

### 2.6 –ü—Ä–æ—Ü–µ–¥—É—Ä–∞ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –∑–∞–¥–∞–Ω–∏—è–º–∏

```sql
CREATE OR REPLACE PROCEDURE manage_sync_jobs(
    p_action VARCHAR2, -- 'ENABLE', 'DISABLE', 'DROP', 'STATUS'
    p_table_name VARCHAR2 DEFAULT NULL -- NULL = –≤—Å–µ –∑–∞–¥–∞–Ω–∏—è
) IS
    v_job_pattern VARCHAR2(128);
    v_count NUMBER := 0;
BEGIN
    -- –û–ø—Ä–µ–¥–µ–ª—è–µ–º –ø–∞—Ç—Ç–µ—Ä–Ω –ø–æ–∏—Å–∫–∞ –∑–∞–¥–∞–Ω–∏–π
    IF p_table_name IS NOT NULL THEN
        -- –ò–∑–≤–ª–µ–∫–∞–µ–º –±–∞–∑–æ–≤–æ–µ –∏–º—è —Ç–∞–±–ª–∏—Ü—ã
        IF INSTR(p_table_name, '.') > 0 THEN
            v_job_pattern := 'SYNC_' || REGEXP_SUBSTR(UPPER(TRIM(p_table_name)), '[^.]+$') || '_JOB';
        ELSE
            v_job_pattern := 'SYNC_' || UPPER(TRIM(p_table_name)) || '_JOB';
        END IF;
    END IF;
    
    DBMS_OUTPUT.PUT_LINE('=== –£–ü–†–ê–í–õ–ï–ù–ò–ï –ó–ê–î–ê–ù–ò–Ø–ú–ò –°–ò–ù–•–†–û–ù–ò–ó–ê–¶–ò–ò ===');
    DBMS_OUTPUT.PUT_LINE('–î–µ–π—Å—Ç–≤–∏–µ: ' || UPPER(p_action));
    IF p_table_name IS NOT NULL THEN
        DBMS_OUTPUT.PUT_LINE('–¢–∞–±–ª–∏—Ü–∞: ' || p_table_name);
    ELSE
        DBMS_OUTPUT.PUT_LINE('–û–±–ª–∞—Å—Ç—å: –≤—Å–µ –∑–∞–¥–∞–Ω–∏—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏');
    END IF;
    DBMS_OUTPUT.PUT_LINE('');
    
    FOR job_rec IN (
        SELECT job_name, enabled, state
        FROM user_scheduler_jobs 
        WHERE job_name LIKE 'SYNC_%_JOB'
        AND (p_table_name IS NULL OR job_name = v_job_pattern)
        ORDER BY job_name
    ) LOOP
        v_count := v_count + 1;
        
        CASE UPPER(p_action)
            WHEN 'ENABLE' THEN
                BEGIN
                    DBMS_SCHEDULER.ENABLE(job_rec.job_name);
                    DBMS_OUTPUT.PUT_LINE('‚úì –í–∫–ª—é—á–µ–Ω–æ: ' || job_rec.job_name);
                EXCEPTION
                    WHEN OTHERS THEN
                        DBMS_OUTPUT.PUT_LINE('‚úó –û—à–∏–±–∫–∞ –≤–∫–ª—é—á–µ–Ω–∏—è ' || job_rec.job_name || ': ' || SQLERRM);
                END;
                
            WHEN 'DISABLE' THEN
                BEGIN
                    DBMS_SCHEDULER.DISABLE(job_rec.job_name);
                    DBMS_OUTPUT.PUT_LINE('‚úì –û—Ç–∫–ª—é—á–µ–Ω–æ: ' || job_rec.job_name);
                EXCEPTION
                    WHEN OTHERS THEN
                        DBMS_OUTPUT.PUT_LINE('‚úó –û—à–∏–±–∫–∞ –æ—Ç–∫–ª—é—á–µ–Ω–∏—è ' || job_rec.job_name || ': ' || SQLERRM);
                END;
                
            WHEN 'DROP' THEN
                BEGIN
                    DBMS_SCHEDULER.DROP_JOB(job_rec.job_name, force => TRUE);
                    DBMS_OUTPUT.PUT_LINE('‚úì –£–¥–∞–ª–µ–Ω–æ: ' || job_rec.job_name);
                EXCEPTION
                    WHEN OTHERS THEN
                        DBMS_OUTPUT.PUT_LINE('‚úó –û—à–∏–±–∫–∞ —É–¥–∞–ª–µ–Ω–∏—è ' || job_rec.job_name || ': ' || SQLERRM);
                END;
                
            WHEN 'STATUS' THEN
                DBMS_OUTPUT.PUT_LINE('üìã ' || job_rec.job_name || 
                    ' | –í–∫–ª—é—á–µ–Ω–æ: ' || job_rec.enabled || 
                    ' | –°–æ—Å—Ç–æ—è–Ω–∏–µ: ' || NVL(job_rec.state, 'N/A'));
            ELSE
                DBMS_OUTPUT.PUT_LINE('‚ùå –ù–µ–∏–∑–≤–µ—Å—Ç–Ω–æ–µ –¥–µ–π—Å—Ç–≤–∏–µ: ' || p_action);
        END CASE;
    END LOOP;
    
    IF v_count = 0 THEN
        DBMS_OUTPUT.PUT_LINE('–ó–∞–¥–∞–Ω–∏—è –Ω–µ –Ω–∞–π–¥–µ–Ω—ã');
    ELSE
        DBMS_OUTPUT.PUT_LINE('');
        DBMS_OUTPUT.PUT_LINE('–û–±—Ä–∞–±–æ—Ç–∞–Ω–æ –∑–∞–¥–∞–Ω–∏–π: ' || v_count);
    END IF;
    
END manage_sync_jobs;
/
```

## –®–∞–≥ 3: –ü—Ä–∏–º–µ—Ä—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è

### 3.1 –°–æ–∑–¥–∞–Ω–∏–µ –∑–∞–¥–∞–Ω–∏—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏

```sql
-- –í–∫–ª—é—á–∞–µ–º –≤—ã–≤–æ–¥ —Å–æ–æ–±—â–µ–Ω–∏–π
SET SERVEROUTPUT ON;

-- –°–æ–∑–¥–∞–Ω–∏–µ –∑–∞–¥–∞–Ω–∏—è –¥–ª—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏ (–∑–∞–º–µ–Ω–∏—Ç–µ YOUR_SCHEMA.YOUR_TABLE –∏ YOUR_DBLINK –Ω–∞ –≤–∞—à–∏ –∑–Ω–∞—á–µ–Ω–∏—è)
BEGIN
    create_smart_sync_job(
        p_table_name        => 'YOUR_SCHEMA.YOUR_TABLE',    -- –ó–∞–º–µ–Ω–∏—Ç–µ –Ω–∞ –≤–∞—à–µ
        p_schedule_interval => 'FREQ=DAILY;BYHOUR=20',      -- –ö–∞–∂–¥—ã–π –¥–µ–Ω—å –≤ 20:00
        p_dblink_name       => 'YOUR_DBLINK',               -- –ó–∞–º–µ–Ω–∏—Ç–µ –Ω–∞ –≤–∞—à dblink  
        p_sync_type         => 'FULL',                      -- –ü–æ–ª–Ω–æ–µ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ
        p_min_row_threshold => 1,                           -- –ú–∏–Ω–∏–º—É–º 1 —Å—Ç—Ä–æ–∫–∞
        p_test_run          => TRUE                         -- –° —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ–º
    );
END;
/
```

### 3.2 –†—É—á–Ω–∞—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è

```sql
-- –†—É—á–Ω–æ–π –∑–∞–ø—É—Å–∫ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏ –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏
BEGIN
    sync_single_table_advanced(
        p_table_name      => 'YOUR_SCHEMA.YOUR_TABLE',
        p_dblink_name     => 'YOUR_DBLINK',
        p_sync_type       => 'FULL',
        p_min_row_threshold => 1
    );
END;
/
```

### 3.3 –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ —Å–∏—Å—Ç–µ–º—ã

```sql
-- –ü—Ä–æ—Å–º–æ—Ç—Ä —Å—Ç–∞—Ç—É—Å–∞ –≤—Å–µ—Ö —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–π
SELECT * FROM v_sync_dashboard;

-- –ü—Ä–æ—Å–º–æ—Ç—Ä –≤—Å–µ—Ö –∑–∞–¥–∞–Ω–∏–π –ø–ª–∞–Ω–∏—Ä–æ–≤—â–∏–∫–∞
BEGIN
    manage_sync_jobs('STATUS');
END;
/

-- –ü—Ä–æ—Å–º–æ—Ç—Ä –ø–æ—Å–ª–µ–¥–Ω–∏—Ö –∑–∞–ø–∏—Å–µ–π –ª–æ–≥–∞
SELECT 
    table_name,
    status,
    sync_date,
    source_row_count,
    target_row_count,
    SUBSTR(error_msg, 1, 100) as error_summary
FROM sync_log 
WHERE sync_date > SYSDATE - 7 
ORDER BY sync_date DESC;
```

