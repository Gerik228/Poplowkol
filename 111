Отлично, вот полная и подробная инструкция, как сделать отображение CLOB с поддержкой более 4000 символов в Oracle APEX Template Component, с использованием PL/SQL-функции вместо VIEW. Это безопасно, не требует SYS-доступа и отлично работает.


---

Цель

У тебя есть таблица с CLOB (например, answer_clob)

Нужно преобразовать этот CLOB в VARCHAR2(32767)

И вставить как #ANSWER_HTML# в Template Component



---

1. Таблица FAQ

Пример структуры:

CREATE TABLE faq_table (
  id           NUMBER GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
  question     VARCHAR2(500),
  answer_clob  CLOB
);


---

2. Создание функции faq_clob_to_varchar

CREATE OR REPLACE FUNCTION faq_clob_to_varchar (
  p_id IN NUMBER
) RETURN VARCHAR2 IS
  l_result  VARCHAR2(32767);
  l_offset  PLS_INTEGER := 1;
  l_chunk   PLS_INTEGER := 4000;
  l_piece   VARCHAR2(4000);
  l_clob    CLOB;
BEGIN
  SELECT answer_clob INTO l_clob FROM faq_table WHERE id = p_id;

  LOOP
    l_piece := DBMS_LOB.SUBSTR(l_clob, l_chunk, l_offset);
    EXIT WHEN l_piece IS NULL OR LENGTH(l_result) + LENGTH(l_piece) > 32767;
    l_result := l_result || l_piece;
    l_offset := l_offset + l_chunk;
  END LOOP;

  RETURN l_result;
EXCEPTION
  WHEN OTHERS THEN
    RETURN 'Ошибка загрузки данных.';
END;


---

3. Пример использования функции

В APEX Template Component или интерактивной карточке:

SELECT
  id,
  question,
  faq_clob_to_varchar(id) AS answer_html
FROM faq_table


---

4. Настрой Template Component

В плагине:

Атрибут: ANSWER_HTML

Тип: VARCHAR2

Escape Special Characters: No


В шаблоне пиши:

<div class="faq-block">#ANSWER_HTML#</div>


---

5. Добавь стили (если нужно)

.faq-block {
  font-family: "Segoe UI", sans-serif;
  background: #f5f5f5;
  padding: 15px;
  border-left: 4px solid #3399cc;
  margin-top: 10px;
}
.faq-block img {
  max-width: 100%;
  border-radius: 5px;
}


---

Плюсы этого подхода:

Не требует SYS-доступа и изменения параметров БД

Работает даже если CLOB > 4000 символов

Поддерживается в SQL и Template Component

Легко расширяется, можно фильтровать или чистить HTML



---

Хочешь — могу сделать вторую версию функции, которая будет удалять <script> или <iframe>, если хочешь безопаснее.

