select 
    l.log_id,
    l.user_name || ' - ' || e.user_fio as user_fio_login,
    m.page_name,
    case 
        when m.dev_or_prod = 1 then 'dev'
        when m.dev_or_prod = 0 then 'hide'
    end as status,
    to_char(l.login_time, 'YYYY-MM-DD HH24:MI:SS') as log_in,
    to_char(l.logout_time, 'YYYY-MM-DD HH24:MI:SS') as log_out,
    round(l.duration_sec) as duration,
    case 
        when exists (
            select 1 
            from apex_appl_acl_user_roles r
            where r.user_name = l.user_name
        ) then '1'
        else '0'
    end as filter

from bi_portal_audit_log l
left join bi_portal_map m on m.id = l.id_dash
left join bi_empl_ldap_dep e on e.ldap = l.user_name

where l.login_time between 
      to_timestamp(coalesce(:PXX_DATE_FROM, trunc(sysdate)), 'YYYY-MM-DD')
  and to_timestamp(coalesce(:PXX_DATE_TO, trunc(sysdate)) + 1, 'YYYY-MM-DD') - interval '1' second