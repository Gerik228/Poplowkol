Отлично! Сейчас дам тебе подробную пошаговую инструкцию, как реализовать SSO-авторизацию в Oracle APEX через LDAP (AD) с использованием твоей функции check_ldap_auth. Эта реализация будет работать без стандартной страницы входа, автоматически логинивая пользователя при успешной проверке.


---

Общая идея

1. Пользователь переходит по ссылке на специальную страницу APEX (например, /f?p=100:9999).


2. Эта страница получает логин/пароль (например, через P9999_USERNAME и P9999_PASSWORD).


3. Процесс вызывает check_ldap_auth.


4. Если авторизация успешна — вызывается apex_authentication.login(...).


5. Пользователь попадает в приложение уже авторизованным.


6. (Опционально) можно использовать cookie или HTTP header, чтобы логинить без пароля.




---

Шаги

1. Создай PL/SQL функцию для авторизации

Ты уже сделал:

FUNCTION check_ldap_auth(p_username IN VARCHAR2, p_password IN VARCHAR2) RETURN BOOLEAN IS
  l_session DBMS_LDAP.SESSION;
  l_retval  PLS_INTEGER;
  res       BOOLEAN;
BEGIN
  BEGIN
    l_session := DBMS_LDAP.init('vld-ads01.pskb.ad', 389);
    l_retval := DBMS_LDAP.simple_bind_s(l_session, 'pskb\' || p_username, p_password);
    res := TRUE;
  EXCEPTION
    WHEN OTHERS THEN
      res := FALSE;
  END;
  RETURN res;
END;

Убедись, что:

У пользователя APEX_xxxxx есть права на DBMS_LDAP (через GRANT EXECUTE ON dbms_ldap TO APEX_xxxx;).

Порт 389 открыт из базы до контроллера домена.



---

2. Создай специальную страницу в APEX (например, 9999)

Тип: Blank Page

Название: SSO Login

Убери навигацию и боковую панель.


Добавь два Hidden Page Items:

P9999_USERNAME

P9999_PASSWORD


(или P9999_TOKEN, если будешь передавать по cookie/токену)


---

3. Добавь PL/SQL-процесс на эту страницу

> В Page Designer → Processing → Create → PL/SQL Code → After Header



declare
  l_success boolean;
begin
  -- Проверяем логин/пароль через AD
  l_success := check_ldap_auth(:P9999_USERNAME, :P9999_PASSWORD);

  if l_success then
    -- Авторизуем пользователя в APEX
    apex_authentication.login(
      p_username => :P9999_USERNAME,

