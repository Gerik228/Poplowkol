Конечно! Ниже я собрал итоговое и полностью рабочее решение на Oracle APEX 23.1.0, полностью соответствующее твоей задаче и всему, что мы обсудили.


---

1. HTML-шаблон (Template Component)

В редакторе шаблона карточки (Partial Template) вставь:

<dt class="x-faq-dt">
  <button type="button" class="x-faq-btn" aria-expanded="false" data-faq-id="#ID#">
    <span class="x-faq-title">#QUESTION#</span>
    <span class="x-faq-icon-parent">
      <span class="fa fa-plus" aria-hidden="true"></span>
      <span class="fa fa-minus" aria-hidden="true" style="display: none;"></span>
    </span>
  </button>
</dt>
<dd class="x-faq-dd" id="faq-answer-#ID#" style="display: none;">
  <div class="faq-loading" style="display: none;">Загрузка...</div>
</dd>

Важно:

Убедись, что в свойствах шаблона отключено Escape Special Characters.

Не вставляй #ANSWER# — он заменяется через AJAX.



---

2. AJAX Callback (на странице 2020)

Name: GET_FAQ_HTML
Тип: PL/SQL Function Returning CLOB

declare
    l_clob clob;
begin
    select des_test
      into l_clob
      from bi_portal_faq
     where id = :P2020_FAQ_ID;

    return l_clob;
end;


---

3. Page Item

Создай скрытый элемент:

Имя: P2020_FAQ_ID

Тип: Hidden

Value Protected: No



---

4. JavaScript (выполняется при загрузке страницы)

Где: Page Designer → Execute when Page Loads

document.querySelectorAll(".x-faq-btn").forEach(function (btn) {
  btn.addEventListener("click", function () {
    const faqId = btn.getAttribute("data-faq-id");
    const answerBlock = document.getElementById("faq-answer-" + faqId);
    const loader = answerBlock.querySelector(".faq-loading");

    const isOpen = btn.getAttribute("aria-expanded") === "true";

    // Меняем состояние кнопки
    btn.setAttribute("aria-expanded", !isOpen);
    btn.querySelector(".fa-plus").style.display = isOpen ? "" : "none";
    btn.querySelector(".fa-minus").style.display = isOpen ? "none" : "";

    // Открываем/закрываем блок
    answerBlock.style.display = isOpen ? "none" : "block";

    // Если еще не загружено — делаем AJAX-запрос
    if (!answerBlock.dataset.loaded && !isOpen) {
      apex.item("P2020_FAQ_ID").setValue(faqId);
      loader.style.display = "block";

      apex.server.process("GET_FAQ_HTML", {
        pageItems: "P2020_FAQ_ID"
      }, {
        dataType: "text",
        success: function (pData) {
          loader.style.display = "none";
          answerBlock.innerHTML = pData;
          answerBlock.dataset.loaded = "true";
        },
        error: function (jqXHR, textStatus, errorThrown) {
          loader.innerHTML = "Ошибка загрузки";
          console.error("AJAX Error:", textStatus, errorThrown);
        }
      });
    }
  });
});


---

5. SQL-источник компонента (Report или Template Component)

select
  id,
  question
from
  bi_portal_faq

Важно: колонка des_test здесь не нужна, так как она будет подгружаться через AJAX.


---

Проверка

Нажимаешь на вопрос → блок раскрывается

AJAX-запрос уходит → возвращает HTML

HTML вставляется в dd как полноценная разметка

Повторный клик не вызывает повторной загрузки



---

Дополнительно (по желанию)

Если ты хочешь, чтобы вопросы загружались каждый раз заново, просто убери строку:

answerBlock.dataset.loaded = "true";


---

Если нужно — могу экспортировать это в .sql как страницу или компонент. Готов?

