(function () {
  document.addEventListener("DOMContentLoaded", function () {
    document.querySelectorAll(".carousel-wrapper").forEach(function (wrapper) {
      const track = wrapper.querySelector(".carousel-track");
      const left = wrapper.querySelector(".carousel-arrow.left");
      const right = wrapper.querySelector(".carousel-arrow.right");
      let cards = wrapper.querySelectorAll(".carousel-card");
      let index = 0;

      function getPerPage() {
        const width = window.innerWidth;
        if (width >= 900) return 3;
        if (width >= 600) return 2;
        return 1;
      }

      function update() {
        const perPage = getPerPage();
        const offset = index * (100 / perPage);
        track.style.transform = `translateX(-${offset}%)`;
        const maxIndex = Math.ceil(cards.length / perPage) - 1;

        left.style.visibility = index === 0 ? 'hidden' : 'visible';
        right.style.visibility = index >= maxIndex ? 'hidden' : 'visible';
      }

      left.addEventListener("click", () => {
        const perPage = getPerPage();
        const maxIndex = Math.ceil(cards.length / perPage) - 1;
        if (index < maxIndex) index++;
        update();
      });

      right.addEventListener("click", () => {
        if (index > 0) index--;
        update();
      });

      window.addEventListener("resize", () => {
        index = 0;
        update();
      });

      setTimeout(update, 150);
    });
  });
})();