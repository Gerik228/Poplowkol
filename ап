Для логирования изменений (обновлений и удалений) в таблице в Oracle APEX можно использовать триггеры. Вот пошаговое решение:

1. Создать таблицу-журнал

Создадим таблицу, куда будут записываться все изменения.

create table audit_log (
    id number generated always as identity primary key,
    table_name varchar2(100),
    action_type varchar2(10), -- 'UPDATE' или 'DELETE'
    record_id number, -- ID измененной/удаленной строки
    old_data clob, -- JSON со старыми данными
    changed_by varchar2(100), -- Пользователь APEX
    changed_at timestamp default systimestamp
);

2. Создать триггер для логирования

Триггер будет записывать старые данные перед изменением или удалением.

create or replace trigger trg_audit_my_table
before update or delete on my_table
for each row
declare
    v_old_data clob;
begin
    -- Формируем JSON из старых данных
    v_old_data := json_object(
        'column1' value :old.column1,
        'column2' value :old.column2,
        'column3' value :old.column3
    ) returning clob;

    -- Вставляем запись в лог
    insert into audit_log (table_name, action_type, record_id, old_data, changed_by)
    values ('MY_TABLE', case when deleting then 'DELETE' else 'UPDATE' end, :old.id, v_old_data, sys_context('APEX$SESSION', 'APP_USER'));
end;
/

Как это работает?

1. При UPDATE: перед обновлением записывается старая версия строки.


2. При DELETE: перед удалением сохраняется удаленная строка.


3. Используется JSON для хранения данных — это удобно для последующего анализа.


4. Фиксируется пользователь через sys_context('APEX$SESSION', 'APP_USER').



Дополнительно: Просмотр логов в APEX

В APEX можно создать Interactive Report на основе таблицы AUDIT_LOG, чтобы отслеживать изменения.

Этот метод гибкий и не требует правок в APEX-приложении. Подойдет?

