Ошибка ORA-00920: invalid relational operator обычно возникает, если в SQL-выражении использован неправильный оператор, например:

Пропущено или неправильно написано case when ... then ... else ... end

Ошибка в insert into

Ошибка в json_object(...)


Исправленный код:

Проверьте этот вариант:

create or replace trigger trg_BI_PORTAL_MAP_PAGES
before update or delete on BI_PORTAL_MAP_PAGES
for each row
declare
    v_old_data clob;
begin
    -- Преобразуем старые значения в JSON
    v_old_data := json_object(
        'ID' value :OLD.ID,
        'APP_ID' value :OLD.APP_ID,
        'PAGE_ID' value :OLD.PAGE_ID,
        'PAGE_NAME' value :OLD.PAGE_NAME,
        'PAGE_ALIAS' value :OLD.PAGE_ALIAS,
        'CREATED_ON' value :OLD.CREATED_ON,
        'CREATED_BY' value :OLD.CREATED_BY,
        'UPDATED_ON' value :OLD.UPDATED_ON,
        'UPDATED_BY' value :OLD.UPDATED_BY,
        'CUSTOMER' value :OLD.CUSTOMER,
        'UPDATE_CYCLE' value :OLD.UPDATE_CYCLE,
        'VERSION' value :OLD.VERSION,
        'LINK_TEH_DOC' value :OLD.LINK_TEH_DOC,
        'PAGE_GROUP' value :OLD.PAGE_GROUP,
        'SUB_SELECTION' value :OLD.SUB_SELECTION,
        'SOURCE' value :OLD.SOURCE,
        'ACCT_TRUE' value :OLD.ACCT_TRUE,
        'NAMUEN_SD_LINK' value :OLD.NAMUEN_SD_LINK,
        'PSI_NAME' value :OLD.PSI_NAME,
        'DOMEN' value :OLD.DOMEN,
        'IMG' value :OLD.IMG,
        'ACCT' value :OLD.ACCT,
        'DEV_OR_PROD' value :OLD.DEV_OR_PROD,
        'PLATFORM' value :OLD.PLATFORM,
        'PAGE_TITLE' value :OLD.PAGE_TITLE,
        'IMAGE_ID' value :OLD.IMAGE_ID,
        'UPDATED_BY_IN_TABLE' value :OLD.UPDATED_BY_IN_TABLE
    );

    -- Вставляем запись в журнал
    insert into audit_log (table_name, operation, changed_by, old_data)
    values (
        'BI_PORTAL_MAP_PAGES',
        case 
            when deleting then 'DELETE' 
            else 'UPDATE' 
        end,
        v('APP_USER'),
        v_old_data
    );
end;
/

Что исправлено?

✅ Использован корректный case when
✅ Исправлено форматирование insert into
✅ Удалён returning clob, (он не нужен)

Попробуйте этот вариант в SQL Workshop. Если ошибка останется, пришлите полный текст ошибки.

