Отлично! Вот полный рабочий код и инструкции, как реализовать страницу в APEX, которая будет отдавать изображение по ID, используя f?p=APP_ID:PAGE_ID:::NO::PXX_ID:<id>.


---

1. Таблица с изображениями

Если ещё нет — создай такую таблицу:

create table product_images (
  id         number generated always as identity primary key,
  name       varchar2(255),
  image_blob blob,
  mime_type  varchar2(255)
);


---

2. Создай страницу-хендлер (например, стр. 100)

Шаги в APEX Builder:

1. Create Page > Blank Page


2. Назови, например, "Get Image"


3. Номер страницы: 100


4. Нажми Next, оставь всё по умолчанию и нажми Finish




---

3. Добавь элемент P100_ID (Hidden item)

1. Перейди в Page Designer


2. В разделе Items, нажми +


3. Тип: Hidden


4. Имя: P100_ID


5. Source:

Type: Always, replacing any existing value in session state

Source Value or Expression: :P100_ID



6. Save




---

4. Добавь PL/SQL-процесс для отдачи BLOB

1. В Page Designer, в разделе Processing нажми +


2. Тип: PL/SQL


3. Название: Download Image


4. Process Point: Before Header


5. Код:



declare
  l_blob blob;
  l_mime varchar2(255);
begin
  select image_blob, mime_type
    into l_blob, l_mime
    from product_images
   where id = :P100_ID;

  owa_util.mime_header(l_mime, false);
  htp.p('Content-length: ' || dbms_lob.getlength(l_blob));
  htp.p('Content-Disposition: inline; filename="image_' || :P100_ID || '"');
  htp.p('');
  owa_util.http_header_close;

  wpg_docload.download_file(l_blob);

  apex_application.stop_apex_engine;
end;

6. Save




---

5. Формат URL для изображения

Формат ссылки:

f?p=APP_ID:100:::NO::P100_ID:<ID>

Пример:

f?p=101:100:::NO::P100_ID:7

Или полный URL:

https://your-domain/ords/f?p=101:100:::NO::P100_ID=7

(Заменить 101 на твой APP_ID, и your-domain на реальный хост)


---

6. (Опционально) Добавь в отчёты/карточки ссылку на изображение

select
  id,
  name,
  'f?p=101:100:::NO::P100_ID=' || id as image_url
from product_images


---

Готово!

Теперь ты можешь использовать постоянный APEX-URL внутри:

интерактивных отчётов

карточек

шаблонов изображений (<img src="...">)

и даже email-шаблонов (если пользователь авторизован)



---

Если хочешь, могу прислать [JSON экспорт страницы 100] для быстрого импорта. Хочешь?

